From f6356c7566e14e82063694c50b60a263e52560bb Mon Sep 17 00:00:00 2001
From: "Darryl L. Pierce" <dpierce@redhat.com>
Date: Wed, 15 Aug 2012 16:39:34 -0400
Subject: [PATCH] Fixes Boost.

---
 qpid/cpp/src/Makefile.am                  | 2 +-
 qpid/cpp/src/qpid/Modules.cpp             | 6 +++---
 qpid/cpp/src/qpid/cluster/StoreStatus.cpp | 4 ++--
 3 files changed, 6 insertions(+), 6 deletions(-)

diff --git a/qpid/cpp/src/Makefile.am b/qpid/cpp/src/Makefile.am
index 276612b..9653044 100644
--- a/qpid/cpp/src/Makefile.am
+++ b/qpid/cpp/src/Makefile.am
@@ -137,7 +137,7 @@ qpidtest_SCRIPTS =
 tmoduleexecdir = $(libdir)/qpid/tests
 tmoduleexec_LTLIBRARIES=
 
-AM_CXXFLAGS += -DBOOST_FILESYSTEM_VERSION=2
+AM_CXXFLAGS += -DBOOST_FILESYSTEM_VERSION=3
 
 ## Automake macros to build libraries and executables.
 qpidd_CXXFLAGS = $(AM_CXXFLAGS) -DQPIDD_MODULE_DIR=\"$(dmoduleexecdir)\" -DQPIDD_CONF_FILE=\"$(sysconfdir)/qpidd.conf\" -DQPIDC_CONF_FILE=\"$(confdir)/qpidc.conf\"
diff --git a/qpid/cpp/src/qpid/Modules.cpp b/qpid/cpp/src/qpid/Modules.cpp
index 727e05d..f934e3e 100644
--- a/qpid/cpp/src/qpid/Modules.cpp
+++ b/qpid/cpp/src/qpid/Modules.cpp
@@ -73,7 +73,7 @@ void tryShlib(const char* libname_, bool noThrow) {
 
 void loadModuleDir (std::string dirname, bool isDefault)
 {
-    fs::path dirPath (dirname, fs::native);
+    fs::path dirPath (dirname);
 
     if (!fs::exists (dirPath))
     {
@@ -89,8 +89,8 @@ void loadModuleDir (std::string dirname, bool isDefault)
     fs::directory_iterator endItr;
     for (fs::directory_iterator itr (dirPath); itr != endItr; ++itr)
     {
-        if (!fs::is_directory(*itr) && isShlibName(itr->string()))
-            tryShlib (itr->string().data(), true);
+      if (!fs::is_directory(*itr) && isShlibName(itr->path().native()))
+        tryShlib (itr->path().native().data(), true);
     }
 }
 
diff --git a/qpid/cpp/src/qpid/cluster/StoreStatus.cpp b/qpid/cpp/src/qpid/cluster/StoreStatus.cpp
index 14c999b..3abb263 100644
--- a/qpid/cpp/src/qpid/cluster/StoreStatus.cpp
+++ b/qpid/cpp/src/qpid/cluster/StoreStatus.cpp
@@ -77,7 +77,7 @@ void StoreStatus::load() {
         throw Exception(QPID_MSG("No data-dir: When a store is loaded together with clustering, --data-dir must be specified."));
     }
     try {
-        fs::path dir = fs::path(dataDir, fs::native)/SUBDIR;
+        fs::path dir = fs::path(dataDir)/SUBDIR;
         create_directory(dir);
         fs::path file = dir/STORE_STATUS;
         if (fs::exists(file)) {
@@ -106,7 +106,7 @@ void StoreStatus::save() {
     try {
         ostringstream os;
         os << clusterId << endl << shutdownId << endl;
-        fs::path file = fs::path(dataDir, fs::native)/SUBDIR/STORE_STATUS;
+        fs::path file = fs::path(dataDir)/SUBDIR/STORE_STATUS;
         writeFile(file, os.str());
     }
     catch (const std::exception& e) {
-- 
1.7.11.4

