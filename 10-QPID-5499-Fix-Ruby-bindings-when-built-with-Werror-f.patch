From ba180ca4a513615339b270f53b5ed78dc4169efe Mon Sep 17 00:00:00 2001
From: "Darryl L. Pierce" <dpierce@redhat.com>
Date: Tue, 21 Jan 2014 14:16:38 -0500
Subject: [PATCH] QPID-5499: Fix Ruby/Perl bindings when built with
 -Werror=format-security

Changed the swig descriptors so that they use a constant format string.
---
 qpid/cpp/bindings/qmf2/ruby/ruby.i         | 2 +-
 qpid/cpp/bindings/qpid/perl/perl.i         | 2 +-
 qpid/cpp/bindings/qpid/ruby/ruby.i         | 2 +-
 qpid/cpp/include/qpid/swig_perl_typemaps.i | 2 +-
 qpid/cpp/include/qpid/swig_ruby_typemaps.i | 2 +-
 5 files changed, 5 insertions(+), 5 deletions(-)

diff --git a/qpid/cpp/bindings/qmf2/ruby/ruby.i b/qpid/cpp/bindings/qmf2/ruby/ruby.i
index 0254017..65d0770 100644
--- a/qpid/cpp/bindings/qmf2/ruby/ruby.i
+++ b/qpid/cpp/bindings/qmf2/ruby/ruby.i
@@ -30,7 +30,7 @@
     }
     catch (qpid::types::Exception& mex) {
         static VALUE qmferror = rb_define_class("QmfError", rb_eStandardError);
-        rb_raise(qmferror, mex.what());
+        rb_raise(qmferror, "%s", mex.what());
     }
 }
 
diff --git a/qpid/cpp/bindings/qpid/perl/perl.i b/qpid/cpp/bindings/qpid/perl/perl.i
index 0d118ae..4dc2665 100644
--- a/qpid/cpp/bindings/qpid/perl/perl.i
+++ b/qpid/cpp/bindings/qpid/perl/perl.i
@@ -27,7 +27,7 @@
         $action
     }
     catch (qpid::messaging::MessagingException& mex) {
-        Perl_croak(aTHX_ mex.what());
+      Perl_croak(aTHX_ "%s", mex.what());
     }
 }
 
diff --git a/qpid/cpp/bindings/qpid/ruby/ruby.i b/qpid/cpp/bindings/qpid/ruby/ruby.i
index 3d686c2..99d29b0 100644
--- a/qpid/cpp/bindings/qpid/ruby/ruby.i
+++ b/qpid/cpp/bindings/qpid/ruby/ruby.i
@@ -30,7 +30,7 @@
     }
     catch (qpid::messaging::MessagingException& mex) {
         static VALUE merror = rb_define_class("MessagingError", rb_eStandardError);
-        rb_raise(merror, mex.what());
+        rb_raise(merror, "%s", mex.what());
     }
 }
 
diff --git a/qpid/cpp/include/qpid/swig_perl_typemaps.i b/qpid/cpp/include/qpid/swig_perl_typemaps.i
index da24bfe..74d2b07 100644
--- a/qpid/cpp/include/qpid/swig_perl_typemaps.i
+++ b/qpid/cpp/include/qpid/swig_perl_typemaps.i
@@ -120,7 +120,7 @@
             }
             }
         } catch (qpid::types::Exception& ex) {
-            Perl_croak(aTHX_ ex.what());
+          Perl_croak(aTHX_ "%s", ex.what());
         }
 
         if (!result)
diff --git a/qpid/cpp/include/qpid/swig_ruby_typemaps.i b/qpid/cpp/include/qpid/swig_ruby_typemaps.i
index 1a07cc8..4e07088 100644
--- a/qpid/cpp/include/qpid/swig_ruby_typemaps.i
+++ b/qpid/cpp/include/qpid/swig_ruby_typemaps.i
@@ -106,7 +106,7 @@
             }
         } catch (qpid::types::Exception& ex) {
             static VALUE error = rb_define_class("Error", rb_eStandardError);
-            rb_raise(error, ex.what());
+            rb_raise(error, "%s", ex.what());
         }
 
         return result;
-- 
1.8.4.2

